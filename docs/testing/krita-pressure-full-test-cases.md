# Krita 压感全链路重构测试用例（双重严格门禁）

## 1. 文档目的

本文件定义压感全链路重构的测试场景、步骤和通过标准。  
验收要求：

1. 阶段门禁通过
2. 最终门禁通过
3. 高速高样本门禁通过

以上三者缺一不可。

---

## 2. 固定前提

1. 输入文件固定为：
   - `C:\Users\LiuYang\AppData\Roaming\com.sutu\debug-data\debug-stroke-capture.json`
2. 画布、笔刷、缩放与导出 schema 使用 Phase 0 冻结配置。
3. 每次执行都记录版本与环境信息。

---

## 3. 核心场景清单

## Case A：慢抬笔（slow_lift）

目标：验证尾段低压衰减是否连续、平滑、无突降。

重点检查：

1. 阶段：采样触发顺序、尾段线性插值。
2. 最终：尾段宽度曲线与像素尾迹一致性。

通过标准：

1. 尾段衰减指标通过。
2. 无尾段断压或异常跳点。

## Case B：快甩笔（fast_flick）

目标：验证高速场景下的稳定性与一致性。

重点检查：

1. 阶段：速度估计稳定性与高速度窗口统计。
2. 最终：尾段宽度收敛与像素差异。

通过标准：

1. 高速窗口数达到门槛。
2. 高速门禁指标全部通过。

## Case C：急停（abrupt_stop）

目标：验证末端采样与 finalize 行为是否一致。

重点检查：

1. 阶段：末端样本消费完整性。
2. 最终：停笔位置附近的形状与浓度一致性。

通过标准：

1. 无末样本丢失。
2. 末端局部 ROI 指标通过。

## Case D：低压慢移（low_pressure_drag）

目标：验证低压近零区域的稳定输出。

重点检查：

1. 阶段：全局曲线映射与动态传感器低压行为。
2. 最终：低压细线连续性与可见性一致。

通过标准：

1. 零压附近无异常抬升或压扁。
2. 低压场景最终门禁通过。

---

## 4. 边界与异常场景

## Case E：首点边界

目标：验证首点处理（初始速度、初始 pressure）一致。

通过标准：

1. 首点阶段指标通过。
2. 首 dab 不出现异常粗细。

## Case F：末点边界

目标：验证 pointer up 附近行为一致。

通过标准：

1. 末点无样本丢失。
2. 末点 ROI 指标通过。

## Case G：零压附近抖动

目标：验证 `pressure -> 0` 附近无数值抖动放大。

通过标准：

1. 阶段近零区误差通过。
2. 最终图无异常断裂/闪断。

## Case H：时间戳突变

目标：验证时间戳跳变时速度估计与采样行为可控。

通过标准：

1. 时间戳异常被正确处理。
2. 不引发连锁失败。

---

## 5. 执行步骤（单轮）

1. 加载固定输入文件。
2. 执行回放并导出阶段结果。
3. 执行最终画面对比。
4. 执行高速窗口统计。
5. 输出总报告与失败原因。

预期输出：

1. 分场景 pass/fail
2. 分阶段 pass/fail
3. 总体 pass/fail
4. 失败原因列表

---

## 6. 通过判定

单场景通过条件：

1. 阶段门禁通过
2. 最终门禁通过
3. 高速门禁（若适用）通过

总体验收通过条件：

1. A/B/C/D 核心场景全部通过
2. E/F/G/H 边界场景全部通过
3. 无阻塞级失败项

---

## 7. 失败定位顺序（固定）

1. 先看阶段门禁失败项（定位规则或公式不一致）。
2. 再看最终门禁失败项（定位视觉结果差异）。
3. 最后看高速门禁失败项（定位稳定性问题）。

说明：

1. 不允许跳过阶段定位直接调最终像素指标。

---

## 8. 回归要求

以下改动必须跑全量用例：

1. 压感曲线映射逻辑变更
2. 速度估计逻辑变更
3. 采样触发或 carry 逻辑变更
4. 插值逻辑变更
5. 动态传感器映射逻辑变更

---

## 9. 报告模板要求

每次执行报告必须包含：

1. 测试时间
2. 输入文件 hash
3. 版本信息（Sutu/Krita/OS）
4. 分场景结果
5. 分门禁结果
6. 失败原因明细

