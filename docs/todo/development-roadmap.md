# PaintBoard 开发路线图

> 版本: 0.1.0 | 创建日期: 2026-01-11

## 项目概览

本文档规划 PaintBoard 从脚手架到可用产品的完整开发路径。采用**渐进式开发**策略，优先实现核心绘画功能，逐步完善专业特性。

---

## 里程碑总览

| 里程碑 | 目标 | 预估工作量 |
|--------|------|-----------|
| **M1: 基础绘画** | 能在画布上画出压感笔迹 | ★★☆☆☆ |
| **M2: 图层系统** | 多图层 + 混合模式 | ★★★☆☆ |
| **M3: 笔刷系统** | 可调节笔刷 + 预设 | ★★★☆☆ |
| **M4: 选区工具** | 套索 + 矩形选区 | ★★★☆☆ |
| **M5: 文件系统** | 保存/加载 + PSD 导入导出 | ★★★★☆ |
| **M6: 专业特性** | 颜色混合 + 性能优化 | ★★★★★ |

---

## M1: 基础绘画 (Foundation)

**目标**: 在画布上实现基本的压感绘画功能

### 任务清单

#### 1.1 画布渲染基础
- [ ] 实现 Canvas 2D 基础渲染（当前已有骨架）
- [ ] 添加 `desynchronized: true` 减少延迟
- [ ] 实现画布缩放/平移（鼠标滚轮 + 空格拖拽）
- [ ] 添加画布背景网格（透明度指示）

#### 1.2 压感输入集成
- [ ] 验证 PointerEvent 压感在 Tauri WebView 中的表现
- [ ] 实现基础压感 → 笔刷大小映射
- [ ] 实现压感 → 不透明度映射
- [ ] 添加压感曲线调节（线性/软/硬）

#### 1.3 笔迹平滑
- [ ] 实现 Catmull-Rom 样条插值
- [ ] 添加点位过滤（去除抖动）
- [ ] 实现笔迹起始/结束渐变

#### 1.4 基础 UI
- [ ] 颜色选择器（前景色/背景色）
- [ ] 笔刷大小滑块
- [ ] 不透明度滑块
- [ ] 撤销/重做按钮

### 验收标准
- ✓ 能用数位板画出平滑、有压感变化的笔迹
- ✓ 笔迹无明显延迟（< 50ms 可感知）
- ✓ 支持缩放和平移画布

---

## M2: 图层系统 (Layers)

**目标**: 实现多图层绘画和基础图层操作

### 任务清单

#### 2.1 图层数据结构
- [ ] 完善 Zustand document store 图层管理
- [ ] 实现图层树结构（支持图层组）
- [ ] 添加图层 ID 生成和管理

#### 2.2 图层渲染
- [ ] 每图层独立 Canvas/纹理
- [ ] 实现图层合成渲染管线
- [ ] 添加图层可见性控制
- [ ] 实现图层不透明度

#### 2.3 混合模式
- [ ] 实现基础混合模式:
  - [ ] Normal（正常）
  - [ ] Multiply（正片叠底）
  - [ ] Screen（滤色）
  - [ ] Overlay（叠加）
- [ ] 扩展混合模式（后续迭代）:
  - [ ] Darken / Lighten
  - [ ] Color Dodge / Color Burn
  - [ ] Soft Light / Hard Light

#### 2.4 图层面板 UI
- [ ] 图层列表显示（缩略图 + 名称）
- [ ] 拖拽排序
- [ ] 可见性切换按钮（眼睛图标）
- [ ] 锁定按钮
- [ ] 不透明度滑块
- [ ] 混合模式下拉选择
- [ ] 右键菜单（删除、复制、合并）

### 验收标准
- ✓ 能创建、删除、重排图层
- ✓ 不同图层的绘画相互独立
- ✓ 混合模式效果正确

---

## M3: 笔刷系统 (Brushes)

**目标**: 实现可自定义的专业笔刷系统

### 任务清单

#### 3.1 笔刷引擎核心
- [ ] 完善 Rust BrushEngine 实现
- [ ] 实现笔刷形状渲染（圆形/椭圆）
- [ ] 添加笔刷硬度控制
- [ ] 实现笔刷间距设置

#### 3.2 笔刷动态
- [ ] 大小动态（压感/倾斜/随机）
- [ ] 不透明度动态
- [ ] 角度动态（跟随方向/倾斜）
- [ ] 散布动态

#### 3.3 笔刷纹理
- [ ] 支持自定义笔刷形状（PNG 导入）
- [ ] 纹理笔刷混合模式
- [ ] 纹理缩放和旋转

#### 3.4 笔刷预设
- [ ] 内置默认笔刷集:
  - [ ] 硬边圆形笔刷
  - [ ] 软边圆形笔刷
  - [ ] 铅笔
  - [ ] 喷枪
- [ ] 笔刷预设保存/加载
- [ ] 笔刷预设面板 UI

#### 3.5 橡皮擦
- [ ] 橡皮擦工具（擦除到透明）
- [ ] 橡皮擦笔刷设置

### 验收标准
- ✓ 能调节笔刷大小、硬度、不透明度
- ✓ 压感影响笔刷效果自然
- ✓ 能保存和加载自定义笔刷

---

## M4: 选区工具 (Selection)

**目标**: 实现 Photoshop 风格的选区系统

### 任务清单

#### 4.1 选区数据结构
- [ ] 选区蒙版表示（位图或路径）
- [ ] 选区布尔运算（加、减、交）
- [ ] 选区边界计算

#### 4.2 选区工具
- [ ] 矩形选框工具
- [ ] 椭圆选框工具
- [ ] 套索工具（自由选择）
- [ ] 多边形套索（Alt 切换直线模式）
- [ ] 魔棒工具（颜色选择）

#### 4.3 选区操作
- [ ] 全选 / 取消选择 / 反选
- [ ] 羽化
- [ ] 扩展 / 收缩
- [ ] 选区变换（移动、缩放）

#### 4.4 选区渲染
- [ ] 蚂蚁线动画边框
- [ ] 选区蒙版叠加显示
- [ ] 选区内限制绘画

### 验收标准
- ✓ 能创建矩形、椭圆、自由选区
- ✓ 选区内绘画正确受限
- ✓ 支持选区布尔运算

---

## M5: 文件系统 (File I/O)

**目标**: 实现项目保存和常见格式导入导出

### 任务清单

#### 5.1 原生项目格式 (.pbp)
- [ ] 设计项目文件结构
- [ ] 实现保存功能
- [ ] 实现加载功能
- [ ] 添加版本兼容性检查

#### 5.2 自动保存
- [ ] 定时自动保存（可配置间隔）
- [ ] 增量保存（仅保存变化）
- [ ] 崩溃恢复机制

#### 5.3 图片导出
- [ ] PNG 导出（支持透明）
- [ ] JPEG 导出（质量可调）
- [ ] 导出选项对话框

#### 5.4 PSD 支持
- [ ] PSD 读取（基础图层结构）
- [ ] PSD 导出（基础图层结构）
- [ ] 处理不支持的 PSD 特性警告

#### 5.5 文件对话框
- [ ] 新建文档对话框（尺寸、DPI）
- [ ] 打开文件对话框
- [ ] 保存/另存为对话框
- [ ] 导出对话框

### 验收标准
- ✓ 能保存和加载项目，所有图层状态保留
- ✓ 能导出 PNG/JPEG
- ✓ 能读取简单的 PSD 文件

---

## M6: 专业特性 (Advanced)

**目标**: 添加专业绘画软件特性，优化性能

### 任务清单

#### 6.1 颜色系统增强
- [ ] HSV/HSL 色盘
- [ ] 色板/色卡管理
- [ ] 取色器工具（吸管）
- [ ] 颜色历史记录

#### 6.2 颜色混合模式
- [ ] PS 式颜色混合（数字混合）
- [ ] 颜料式颜色混合（物理模拟）
- [ ] 混合模式切换

#### 6.3 历史记录
- [ ] 撤销/重做堆栈（可配置深度）
- [ ] 历史记录面板
- [ ] 快照功能

#### 6.4 性能优化
- [ ] 迁移到 WebGPU 渲染
- [ ] 大画布分块渲染（Tile-based）
- [ ] 图层缓存优化
- [ ] 内存使用监控

#### 6.5 Rust 输入管线
- [ ] 集成 octotablet 直接采集
- [ ] 输入预测（减少感知延迟）
- [ ] 高频输入处理（> 200Hz）

#### 6.6 快捷键系统
- [ ] 工具切换快捷键
- [ ] 笔刷大小 [ ] 快捷调节
- [ ] 自定义快捷键配置

### 验收标准
- ✓ 输入延迟 < 12ms
- ✓ 8K 画布流畅操作
- ✓ 专业级颜色混合效果

---

## 技术债务与持续改进

### 代码质量
- [ ] 补充单元测试覆盖率到 80%
- [ ] 添加集成测试
- [ ] 性能基准测试（Criterion）
- [ ] 修复 Clippy 警告

### 文档
- [ ] API 文档
- [ ] 用户使用指南
- [ ] 贡献者指南

### CI/CD
- [ ] 自动化测试流水线
- [ ] 自动构建发布包
- [ ] 版本号管理

---

## 开发优先级建议

### 第一阶段：最小可用产品 (MVP)
1. **M1: 基础绘画** - 核心体验
2. **M2.1-2.2: 基础图层** - 分层绘画
3. **M3.1-3.2: 基础笔刷** - 笔刷调节

### 第二阶段：功能完善
4. **M2.3-2.4: 混合模式 + UI**
5. **M3.3-3.5: 高级笔刷**
6. **M5.1-5.3: 文件保存**

### 第三阶段：专业化
7. **M4: 选区系统**
8. **M5.4: PSD 支持**
9. **M6: 专业特性**

---

## 风险与注意事项

| 风险 | 影响 | 应对策略 |
|------|------|----------|
| WebGPU 浏览器兼容性 | 无法使用 GPU 加速 | 保留 Canvas 2D 降级方案 |
| octotablet 设备兼容性 | 部分数位板无法使用 | 保留 PointerEvent 备选方案 |
| PSD 格式复杂性 | 导入导出不完整 | 明确支持范围，渐进式实现 |
| 大画布内存压力 | 内存溢出 | 分块加载 + 内存监控 |

---

## 附录：命名约定

### 文件命名
- 组件: `PascalCase.tsx` (例: `LayerPanel.tsx`)
- 工具函数: `camelCase.ts` (例: `colorUtils.ts`)
- 常量: `UPPER_SNAKE_CASE`
- Rust 模块: `snake_case.rs`

### 分支命名
- 功能: `feature/m1-basic-canvas`
- 修复: `fix/brush-pressure-curve`
- 重构: `refactor/layer-store`

---

*本文档将随项目进展持续更新*
