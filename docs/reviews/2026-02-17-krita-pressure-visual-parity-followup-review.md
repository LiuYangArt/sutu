# Reviewï¼šKrita å‹æ„Ÿè§†è§‰ä¸€è‡´æ€§åç»­è®¡åˆ’

**å®¡æ ¸æ—¥æœŸ**ï¼š2026-02-17
**å®¡æ ¸å¯¹è±¡**ï¼š`docs/plans/2026-02-17-krita-pressure-visual-parity-followup-plan.md`
**äº¤å‰å¼•ç”¨**ï¼š`docs/plans/2026-02-17-krita-pressure-tail-parity-plan.md`

---

## 1. æºç é”šç‚¹éªŒè¯ç»“æœ

é€ä¸€æ ¸å¯¹äº†æ–‡æ¡£å¼•ç”¨çš„ Krita æºç ä¸ PaintBoard å¯¹åº”å®ç°ï¼š

### âœ… å·²ç¡®è®¤å‡†ç¡®

| é”šç‚¹                            | Krita æºç                              | éªŒè¯ç»“è®º                                                                       |
| ------------------------------- | -------------------------------------- | ------------------------------------------------------------------------------ |
| `paintLine` ä¸»å¾ªç¯              | `kis_paintop_utils.h:54-103`           | `getNextPointPosition` + `mix(t, pi1, pi2)` + `paintAt` ä¸‰æ­¥é€æ ·æœ¬æ¨è¿›         |
| `mix` çº¿æ€§æ’å€¼                  | `kis_paint_information.cc:569-648`     | `pressure = (1 - t) * other.pressure() + t * this->pressure()`ï¼Œ**ç¡®è®¤çº¯çº¿æ€§** |
| `getNextPointPosition` æœ€æ—©è§¦å‘ | `kis_distance_information.cpp:405-448` | `t = qMin(distanceFactor, timeFactor)`ï¼Œå– distance/time ä¸­æ›´å°çš„ t            |
| `resetAccumulators` è€¦åˆæ¸…é›¶    | `kis_distance_information.cpp:589-593` | distance å’Œ time åŒæ—¶å½’é›¶                                                      |
| smoothing ä¸å½±å“å‹æ„Ÿ            | `kis_tool_freehand_helper.cpp:472-679` | `Smoothing = None` æ—¶ç›´æ¥èµ° `paintLine`ï¼Œå¯¹å‹æ„Ÿé›¶å¹²é¢„                          |

### âœ… PaintBoard ç«¯å·®å¼‚ç¡®è®¤

| å·®å¼‚é¡¹                                      | PaintBoard è¡Œå·             | ç¡®è®¤å­˜åœ¨           |
| ------------------------------------------- | --------------------------- | ------------------ |
| `MIN_MOVEMENT_DISTANCE = 3` èµ·ç¬”é—¨æ§›        | `strokeBuffer.ts:1412`      | âœ… Krita æ— ç­‰ä»·ç‰©  |
| é buildup èµ·å§‹ `pressure: 0`               | `strokeBuffer.ts:1776`      | âœ… Krita æ— ç­‰ä»·ç‰©  |
| `appendStrokeStartTransitionDabs` äººå·¥ ramp | `strokeBuffer.ts:1611-1675` | âœ… Krita æ— ç­‰ä»·ç‰©  |
| `SegmentSampler` æœ€æ—©è§¦å‘è¯­ä¹‰               | `segmentSampler.ts:98-100`  | âœ… å·²ä¸ Krita ä¸€è‡´ |
| `emitSegmentDabs` çº¿æ€§å‹æ„Ÿæ’å€¼              | `strokeBuffer.ts:1713`      | âœ… å·²ä¸ Krita ä¸€è‡´ |

---

## 2. ç½®ä¿¡åº¦è¯„ä¼°

### ğŸŸ¢ é«˜ç½®ä¿¡åº¦ï¼ˆå¯åšåˆ°ä¸€è‡´ï¼‰

1. **å‹æ„Ÿæ’å€¼è¯­ä¹‰**ï¼šPaintBoard æ®µå†…å·²æ˜¯çº¿æ€§æ’å€¼ï¼Œä¸ Krita `mix` å®Œå…¨ä¸€è‡´ã€‚
2. **é‡‡æ ·è§¦å‘è¯­ä¹‰**ï¼š`SegmentSampler` ä½¿ç”¨ `Math.min(deltaTDistance, deltaTTime)`ï¼Œä¸ Krita `qMin(distanceFactor, timeFactor)` ç­‰ä»·ã€‚
3. **Smoothing è¾¹ç•Œæ’é™¤**ï¼šKrita `Brush Smoothing = None` ä¸‹å¯¹å‹æ„Ÿé›¶å¹²é¢„ï¼Œæ–‡æ¡£æ’é™¤ smoothing çš„è¾¹ç•Œåˆ’åˆ†**å®Œå…¨æ­£ç¡®**ã€‚
4. **æ”¶ç¬”æœ«æ ·æœ¬æ¶ˆè´¹**ï¼š`pointerup_fallback` ç­–ç•¥ä¸ `fallbackPressurePolicy` é“¾è·¯å·²æœ‰å®ç°åŸºç¡€ã€‚

### ğŸŸ¡ ä¸­ç­‰ç½®ä¿¡åº¦ï¼ˆæ–¹å‘æ­£ç¡®ï¼Œéœ€è°ƒè¯•éªŒè¯ï¼‰

1. **èµ·ç¬”äººå·¥è¿‡æ¸¡å»é™¤ï¼ˆPhase 5Bï¼‰**ï¼š`appendStrokeStartTransitionDabs` + `MIN_MOVEMENT_DISTANCE` + é buildup é¦–å‹å½’é›¶ æ˜¯é¦–å°¾ä¸é¡ºæ»‘çš„é«˜æ¦‚ç‡ä¸»å› ï¼Œå»é™¤åå¤§æ¦‚ç‡æ˜¾è‘—æ”¹å–„ã€‚ä½†å»é™¤åéœ€éªŒè¯æ˜¯å¦å¼•å…¥èµ·ç¬”æŠ–åŠ¨ç­‰å‰¯ä½œç”¨ã€‚
2. **Gate v2 æŒ‡æ ‡è®¾è®¡**ï¼šä¸‰çª—å£åˆ’åˆ†+æ–°æŒ‡æ ‡è®¾è®¡åˆç†ï¼Œä½†é˜ˆå€¼å®Œå…¨æœªç»å®é™…æ ¡å‡†ï¼Œéœ€ Phase 5C å®æˆ˜æ ¡å‡†åæ‰èƒ½ç¡®å®šå¯è¡Œæ€§ã€‚

### ğŸŸ  é£é™©ç‚¹å¤„ç†å†³è®®ï¼ˆå·²è½¬å…¥è®¡åˆ’ï¼‰

1. **spacing åŠ¨æ€æ›´æ–°**ï¼šKrita `paintLine` æœ«å°¾æœ‰ `needsSpacingUpdate` / `needsTimingUpdate` é€»è¾‘ï¼ˆ`kis_paintop_utils.h:97-102`ï¼‰ï¼Œä¼šåœ¨ dab é—´éš™ä¸»åŠ¨æ›´æ–° spacing/timingã€‚PaintBoard çš„ `SegmentSampler` ä½¿ç”¨å›ºå®š spacingï¼Œ**æ–‡æ¡£æœªåˆ†ææ­¤å·®å¼‚**ã€‚å¯¹ pressure-only ç”»ç¬”å½±å“è¾ƒå°ï¼ˆspacing é€šå¸¸å›ºå®šï¼‰ï¼Œä½†è‹¥åç»­æ‰©å±•åˆ°åŠ¨æ€ spacing ç”»ç¬”ä¼šæˆä¸ºé—®é¢˜ã€‚
2. **é¦– dab çš„ `lastDabInfoValid` è·¯å¾„**ï¼šKrita `paintLine` é¦–æ¬¡è°ƒç”¨æ—¶ `currentDistance` çš„ `lastDabInfoValid` ä¸º falseï¼Œå½±å“é¦–æ¬¡å¾ªç¯è¡Œä¸ºã€‚æ–‡æ¡£æœªæ˜ç¡®åˆ†ææ­¤è·¯å¾„å·®å¼‚ã€‚
3. **"å®Œå…¨ä¸€è‡´" çš„é‡åŒ–ä¸Šé™**ï¼šäº‹ä»¶é‡‡æ ·ç‡ï¼ˆQt tablet events vs PointerEventï¼‰ã€æ—¶é—´æˆ³ç²¾åº¦ã€æµ®ç‚¹è·¯å¾„çš„ç³»ç»Ÿçº§å·®å¼‚ä¼šå¯¼è‡´å¾®å°åå·®ã€‚å»ºè®®åœ¨æ–‡æ¡£ä¸­æ˜ç¡®"ä¸€è‡´æ€§"çš„é‡åŒ–ç›®æ ‡ï¼ˆå¦‚ pressure MAE < 0.02ï¼‰ï¼Œè€Œéä½¿ç”¨"å®Œå…¨ä¸€è‡´"è¿™ä¸€ä¸å¯è¾¾æè¿°ã€‚

å¤„ç†å†³è®®ï¼š

1. åœ¨ follow-up plan ä¸­æ–°å¢ä½œç”¨åŸŸçº¦æŸï¼šPressure-Only åŸºçº¿ä¸‹æ˜¾å¼å†»ç»“åŠ¨æ€ spacing/timingï¼Œå¹¶æ–°å¢ `pressure_only_scope_has_no_dynamic_spacing_update` è¯­ä¹‰æ£€æŸ¥ï¼Œé¿å…æŠŠ scope å¤–å·®å¼‚æ··å…¥æœ¬ä¸“é¡¹ç»“è®ºã€‚
2. åœ¨ follow-up plan ä¸­æ–°å¢é¦– dab è¯­ä¹‰æ£€æŸ¥ï¼š`first_dab_path_matches_lastDabInfoValid_semantics`ï¼Œå¹¶è¦æ±‚åœ¨ `summary.json` ä¸­è¾“å‡ºè¯¥æ£€æŸ¥ç»“æœã€‚
3. åœ¨ follow-up plan ä¸­æŠŠâ€œä¸¥æ ¼ä¸€è‡´â€æ”¹ä¸ºå¯è¾¾å®šä¹‰ï¼ˆè¯­ä¹‰ç­‰ä»· + æŒ‡æ ‡è¾¾æ ‡ + è§†è§‰ç¨³å®šå¤ç°ï¼‰ï¼Œå¹¶è¡¥å…… v1 é‡åŒ–ä¸Šé™ï¼ˆå« `head_pressure_mae <= 0.020`ï¼‰ã€‚

---

## 3. æ–¹æ¡ˆç»“æ„è¯„ä¼°

| è¯„ä¼°é¡¹                                | ç»“è®º                                        |
| ------------------------------------- | ------------------------------------------- |
| èŒƒå›´å†»ç»“ä¸è¾¹ç•Œåˆ’åˆ†                    | âœ… æ¸…æ™°ä¸”æ­£ç¡®ï¼Œæ’é™¤ smoothing æœ‰æºç æ”¯æ’‘    |
| Phase æ‰§è¡Œé¡ºåºï¼ˆ5Aâ†’5Bâ†’5Câ†’5Dï¼‰         | âœ… å…ˆä¿®å·¥å…·å†ä¿®å®ç°ï¼Œé€»è¾‘æ­£ç¡®               |
| è¯­ä¹‰å‰ç½®æ£€æŸ¥ï¼ˆçŸ­è·¯å¤±è´¥ï¼‰              | âœ… å¥½çš„é˜²å¾¡æªæ–½ï¼Œé¿å…"æŒ‡æ ‡è¿‡çº¿ä½†è¯­ä¹‰ä¸ä¸€è‡´" |
| é˜ˆå€¼æ²»ç†ï¼ˆstrict vs calibrated åˆ†ç¦»ï¼‰ | âœ… é¿å…"æ ¡å‡†æ”¾æ°´"ï¼Œè®¾è®¡åˆç†                 |
| éªŒæ”¶ä¸‰å±‚ï¼ˆè¯­ä¹‰/æ•°å€¼/äººå·¥ï¼‰            | âœ… è¦†ç›–å…¨é¢                                 |

---

## 4. æ€»ç»“

**æ–¹æ¡ˆå¯æ‰§è¡Œï¼Œç½®ä¿¡åº¦ä¸­é«˜ï¼ˆåœ¨æ–°å¢å£å¾„è½åœ°åå¯æå‡ï¼‰**ã€‚åœ¨ä»¥ä¸‹å‰æä¸‹å¯ä»¥åšåˆ°ä¸ Krita å‹æ„Ÿé“¾è·¯é«˜åº¦ä¸€è‡´ï¼š

1. éªŒæ”¶æ¡ä»¶å›ºå®šä¸º `Brush Smoothing = None`ï¼ˆå·²æ˜ç¡®ï¼‰
2. ä½¿ç”¨ pressure-only ç”»ç¬”ï¼ˆå·²æ˜ç¡®ï¼‰
3. å»é™¤èµ·ç¬”äººå·¥è¿‡æ¸¡åä¸å¼•å…¥ä¸¥é‡å‰¯ä½œç”¨ï¼ˆPhase 5B éœ€éªŒè¯ï¼‰

**çŠ¶æ€æ›´æ–°**ï¼š

1. å·²è¡¥å……â€œä¸¥æ ¼ä¸€è‡´å¯è¾¾å®šä¹‰â€ä¸é‡åŒ–ä¸Šé™ã€‚
2. å·²è¡¥å…… spacing åŠ¨æ€æ›´æ–°å·®å¼‚åŠå…¶ Pressure-Only ä½œç”¨åŸŸçº¦æŸã€‚
3. å·²è¡¥å……é¦– dab `lastDabInfoValid` è·¯å¾„æ£€æŸ¥è¦æ±‚ã€‚
